pipeline {
  agent any
  environment {
    GIT_COMMIT = ""
  }
  stages {
    stage('Get Git commit hash') {
      steps {
        script {
          GIT_COMMIT = sh(script: 'git rev-parse --short HEAD', returnStdout: true).trim()
        }
      }
    }
    stage('Build Docker images') {
      steps {
        sh 'docker build -t $DOCKERHUB_USERNAME/cicd-pipeline-image:${GIT_COMMIT} .'
        sh 'docker build -t $DOCKERHUB_USERNAME/cicd-pipeline-image:latest .'
      }
    }
    stage('Push Docker images to DockerHub') {
      steps {
        sh 'docker push $DOCKERHUB_USERNAME/cicd-pipeline-image:${GIT_COMMIT}'
        sh 'docker push $DOCKERHUB_USERNAME/cicd-pipeline-image:latest'
      }
    }
  }
    triggers {
    githubPush()
  }
}
